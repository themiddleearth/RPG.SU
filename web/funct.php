<?//ob_start('ob_gzhandler',9);require('inc/config.inc.php');include('inc/lib.inc.php');require_once('inc/db.inc.php');if (!defined("MODULE_ID")){	define("MODULE_ID", 'MODULE_ID');}else{	die();}require('inc/lib_session.inc.php');require('inc/template_header.inc.php');if (function_exists("start_debug")) start_debug(); function upload_file($files, $add, $type, $uploaddir="./files/"){	$count_file = is_array($files['file']['name']) ? count($files['file']['name']) : 0;	for($i=0;$i<$count_file;$i++) 	{		if ($files['file']['error'][$i]==0 and $files['file']['name'][$i]<>'') 		{			myquery("Insert Into attachments (attach_from_id, attach_name, attach_type) Values ('".$add."', '".$files['file']['name'][$i]."', '".$type."')");			$new=mysql_insert_id();			$uploadfile = $uploaddir.$new.".ath";			if (move_uploaded_file($files["file"]["tmp_name"][$i], $uploadfile))			{				echo 'Файл '.$files['file']['name'][$i].' загружен.<br>';			}			else			{				echo 'Файл '.$files['file']['name'][$i].' не загружен.<br>';				myquery("Delete From attachments Where attach_id='".$new."'");			}		}	}}function print_online(&$array){	global $char,$user_id;	$array_size = count($array);	for ($index = 0; $index < $array_size; $index++) 	{		$player = $array[$index];		if($player['admin_id']=='1')		{			echo'<b>';		}				$arena = 0;		if ($player['maps_name']=='Арена Хаоса')		{			$arena = 1;			$player['name']='******';		}				if ($char['clan_id']==1 OR $user_id==36051 OR $user_id==612)		{			echo '<a href="?func=online&teleport_map_name='.$player["map_name"].'&teleport_map_xpos='.$player["map_xpos"].'&teleport_map_ypos='.$player["map_ypos"].'"><img src="http://'.img_domain.'/nav/show.gif" border="0"></a>';		}		if ($arena!=1)		{			echo '<a href="http://'.domain_name.'/view/?userid='.$player["user_id"].'" target="_blank"><img src="http://'.img_domain.'/nav/i.gif" border=0 alt="Инфо"  title="Инфо" width=12 height=12></a>&nbsp;';			echo'<a href="act.php?func=pm&pm=write&new&komu='.htmlentities(urlencode($player["name"])).'" title="Написать личное сообщение"><img src="http://'.img_domain.'/pm/new_pm.gif" border="0" alt="Написать личное сообщение" width=18 height=12></a>&nbsp;';			if ($player['clan_id']!='0') 			{				echo'<img src="http://'.img_domain.'/clan/'.$player['clan_id'].'.gif" alt="'.$player['clan_name'].'" title="'.$player['clan_name'].'">&nbsp;';			}			print_sklon($player);		}		$bold = false;		if (check_attack($char,$player,0,$player)==1) $bold = true;		if ($bold) echo '<font color=#FFFF80>';		if($player['admin_id']=='1')		{			echo '<span ';?>onmousemove=movehint(event) onmouseover="showhint('<font color=#003366><center>Статус игрока:</font>','<?			if($player['clan_id']==1)			{				echo' <font color=#990000><b><center>АДМИНИСТРАТОР игры</center></b></font>';			}			else			{				echo' <font color=#990000><center>Страж игры</center></font>';			};	?>',0,1,event)" onmouseout="showhint('','',0,0,event)"<? echo'>' . $player['name'] . '';			if ($arena!=1) echo ' (' . mysqlresult(myquery("SELECT name FROM game_har WHERE id=".$player['race'].""),0,0) . ' ' . $player['clevel'] . ' уровня)';			echo '</span>';		}		else		{			echo'' . $player['name'] . ' ';			if ($arena!=1) echo '(' . $player['race_name'] . ' ' . $player['clevel'] . ' уровня)';		}		if ($player['dolina']==1 OR $arena)		{		}		else		{			echo' x-' . $player['map_xpos'] . ' y-' . $player['map_ypos'] . '';				}		if ($bold) echo '</font>';		//echo' <font size=1 color=ff0000 face=verdana><b>'.get_delay_reason($player['delay_reason']).'</b></font>';		if($player['admin_id']=='1')		{			echo'</b>';		}		echo'<br>';	}}if (isset($_GET['map'])){  $map = $_GET['map'];	echo'<span id=qwe name=qwe><ol>';	$current_time = time();	$online_range = $current_time - 300;	$zelye_zorkosti = mysqlresult(myquery("SELECT COUNT(*) FROM game_obelisk_users WHERE user_id=$user_id AND type=4 AND time_end>".time().""),0,0);	$str_query = "	select 	view_active_users.*, 	game_admins.ban AS admin_id,	game_users_map.map_xpos,	game_users_map.map_ypos,	game_users_map.map_name,	game_har.name AS race_name,	game_maps.name AS maps_name,	game_maps.boy_type1,	game_maps.boy_type2,	game_maps.boy_type3,	game_maps.boy_type4,	game_maps.boy_type5,	game_maps.boy_type6,	game_maps.boy_type7,	game_clans.nazv AS clan_name,	game_maps.dolina AS dolina	from 	(view_active_users,game_users_map,game_maps,game_har)	left join	(game_admins)	ON	(game_admins.user_id=view_active_users.user_id) 	left join	(game_clans)	ON	(game_clans.clan_id=view_active_users.clan_id) 	where 	game_users_map.user_id=view_active_users.user_id AND game_users_map.map_name=$map AND game_maps.id=$map AND game_har.id=view_active_users.race ";	if ($zelye_zorkosti==0)	{		$str_query.=" AND view_active_users.user_id NOT IN (SELECT user_id FROM game_obelisk_users WHERE time_end>".time()." AND type=5) ";	}	$str_query.="ORDER BY 	view_active_users.clan_id ASC, view_active_users.clevel DESC, view_active_users.name ASC";	$sel = myquery($str_query);		$clans = array();	$notclans = array();	while ($player = mysql_fetch_assoc($sel))	{		if ($player['clan_id']==0)		{			$notclans[]=$player;		}		else		{			$clans[]=$player;		}	}		print_online($clans);	print_online($notclans);	echo'</ol></span>';}if (isset($_GET['item'])){	echo'<span id=qwe><br>';	$item=(int)$_GET['item'];	$from_house = false;	$from_craft = false;		if ((getFunc($user_id)==9)AND(isset($option)))	{		$from_house = true;	}	if (getFunc($user_id)==2)	{		$from_craft = true;	}		$col_14 = 0;    $col_part_svitok_hranitel = 0;    $col_part_svitok_ice = 0;	if ($item==500 AND !$from_house) //ресурсы	{		$select=myquery("SELECT cr.*, cru.col, cru.dead_time FROM craft_resource_user cru JOIN craft_resource cr ON cru.res_id = cr.id WHERE cru.user_id='$user_id' and cru.col>0 ");		if (mysql_num_rows($select)) 		{			$vesall='0';			echo '<table>';			while($res=mysql_fetch_array($select))			{								$ves=$res['weight']*$res['col'];				echo '<tr>';				echo "<td><img src=http://".img_domain."/item/resources/".$res['img3'].".gif border=0 width=50 height=50 align=middle></td>";				echo "<td>".$res['name']." - ".$res['col']." (общий вес: ".$ves.")";				if ($res['dead_time']>0)				{					echo "<br><i>Исчезнет примерно в ".date("H:i d.m.Y",$res['dead_time'])."</i>";				}				echo '</td>'; 				echo "<td><a href=\"?func=inv&dropres=".$res['id']."\">Выбросить</a></td>";				echo '</tr>';				$vesall=$vesall+$ves;			}			echo '</table>';			echo'<br>Общий вес всех ресурсов: '.$vesall.' кг';		}	}	elseif ($item==13) //эликсиры	{		$result_items = myquery("SELECT game_items.id,game_items.item_id from game_items left join game_items_factsheet on game_items.item_id=game_items_factsheet.id WHERE game_items.user_id=$user_id AND game_items.used=0 AND game_items.priznak=0 and game_items_factsheet.type=13 ORDER BY game_items_factsheet.name");		if (mysql_num_rows($result_items) > 0)		{			echo '<table cellpadding="0" cellspacing="4" border="0">';			while ($items = mysql_fetch_array($result_items))			{				$Item = new Item($items['id']);				echo '<tr><td>';				$Item->hint(0,1,'<span '); 				ImageItem($Item->fact['img'],0,$Item->item['kleymo']);				echo '</span>';				echo '</td>';				echo '<td><b>'.$Item->name.'</b>';					echo '<br />';				echo 'Количество эликсиров: '.$Item->getItem('count_item').'';                if ($Item->fact['can_up']==1)                {                  if (!$from_house)                  {				    echo '</td></tr><tr><td>&nbsp;</td><td><a href="http://'.domain_name.'/item.php?inv_option=equip&slot=1&id='.$items['id'].'">Положить в карман 1</a>';					echo '<br /><a href="http://'.domain_name.'/item.php?inv_option=equip&slot=2&id='.$items['id'].'">Положить в карман 2</a>';					echo '<br /><a href="http://'.domain_name.'/item.php?inv_option=equip&slot=3&id='.$items['id'].'">Положить в карман 3</a><br />';                  }                  else                  {				    echo '</td></tr><tr><td>&nbsp;</td><td>					            <a href="http://'.domain_name.'/item.php?inv_option=equip&slot=1&house&option='.$option.'&id='.$items['id'].'">Положить в карман 1</a>';				    echo '<br /><a href="http://'.domain_name.'/item.php?inv_option=equip&slot=2&house&option='.$option.'&id='.$items['id'].'">Положить в карман 2</a>';				    echo '<br /><a href="http://'.domain_name.'/item.php?inv_option=equip&slot=3&house&option='.$option.'&id='.$items['id'].'">Положить в карман 3</a><br />';                  }                }				if ($from_house OR $from_craft)				{					echo '<td>&nbsp;</td>';					echo '<td>&nbsp;</td>';									}				else				{					echo '<td> |&nbsp;<a href="?func=inv&option=eliksir&id='.$items['id'].'">Использовать</a></td>';										echo "<td> |&nbsp;&nbsp;<a href=\"?func=inv&dropitm=".$items['id']."\">Выкинуть</a></td>";									}				echo '</tr>';			}			echo '</table>';		}	}	elseif ($item==12) //свитки	{		$result_items = myquery("SELECT game_items.id,game_items.item_id from game_items left join game_items_factsheet on game_items.item_id=game_items_factsheet.id WHERE game_items.user_id=$user_id AND game_items.used=0 AND game_items.priznak=0 and game_items_factsheet.type=12 ORDER BY game_items_factsheet.name");		if (mysql_num_rows($result_items) > 0)		{			echo '<table cellpadding="0" cellspacing="4" border="0">';			while ($items = mysql_fetch_array($result_items))			{				$Item = new Item($items['id']);				echo '<tr><td>';				ImageItem($Item->fact['img'],0,$Item->item['kleymo']);				echo '</td>				<td><b>'.$Item->getFact('name').'</b>';				if ($Item->getFact('id')==svitok_small_item_id) echo '<br><i>(Позволяет вступать в бой на обычных условиях после 2 хода)</i>';				if ($Item->getFact('id')==svitok_sred_item_id) echo '<br><i>(Позволяет вступать в любой бой до конца 6 хода)</i>';				if ($Item->getFact('id')==svitok_big_item_id) echo '<br><i>(Позволяет вступать в любой бой в любое время)</i>';				echo '</td>				<td>';				echo '<br />';				echo 'Количество свитков: '.$Item->getItem('count_item').'';				echo '</td></tr>';                if ($Item->fact['can_up']==1)                {//                    echo '<tr><td>&nbsp;</td><td><a href="item.php?inv_option=equip&slot=1&id='.$items['id'].'">Положить в карман 1</a><br /><a href="item.php?inv_option=equip&slot=2&id='.$items['id'].'">Положить в карман 2</a><br /><a href="item.php?inv_option=equip&slot=3&id='.$items['id'].'">Положить в карман 3</a></td></tr>';                  if (!$from_house)                  {                    echo '</td></tr><tr><td>&nbsp;</td><td><a href="http://'.domain_name.'/item.php?inv_option=equip&slot=1&id='.$items['id'].'">Положить в карман 1</a>';                    echo '<br /><a href="http://'.domain_name.'/item.php?inv_option=equip&slot=2&id='.$items['id'].'">Положить в карман 2</a>';                    echo '<br /><a href="http://'.domain_name.'/item.php?inv_option=equip&slot=3&id='.$items['id'].'">Положить в карман 3</a><br />';                  }                  else                  {                    echo '</td></tr><tr><td>&nbsp;</td><td><a href="http://'.domain_name.'/item.php?inv_option=equip&slot=1&house&id='.$items['id'].'">Положить в карман 1</a>';                    echo '<br /><a href="http://'.domain_name.'/item.php?inv_option=equip&slot=2&house&id='.$items['id'].'">Положить в карман 2</a>';                    echo '<br /><a href="http://'.domain_name.'/item.php?inv_option=equip&slot=3&house&id='.$items['id'].'">Положить в карман 3</a><br />';                  }                }			}			echo '</table>';		}	}	elseif ($item==19 OR $item==21) //стрелы или метат.предметы	{		$result_items = myquery("SELECT game_items.id,game_items.item_id from game_items left join game_items_factsheet on game_items.item_id=game_items_factsheet.id WHERE game_items.user_id=$user_id AND game_items.used=0 AND game_items.priznak=0 AND game_items.item_uselife>0 and game_items_factsheet.type=$item ORDER BY game_items_factsheet.name");		if (mysql_num_rows($result_items) > 0)		{			echo '<table cellpadding="0" cellspacing="4" border="0">';			while ($items = mysql_fetch_array($result_items))			{				$Item = new Item($items['id']);				echo '<tr><td>';				$Item->hint(0,1,'<span '); 				ImageItem($Item->fact['img'],0,$Item->item['kleymo']);				echo '</span>';				echo '</td>				<td><b>'.$Item->getFact('name').'</b>';				echo '<br /><br />';				echo 'Количество предметов: '.$Item->getItem('count_item').'';				echo '</td><td>';				if ($Item->item['personal']==0 AND !$from_house)				{                                                                                          										echo "<a href=\"?func=inv&dropitm=".$items['id']."\">Выкинуть</a></td><td>&nbsp;|&nbsp;";				}				if ($from_house)				{					$ss = 'hero.php?option='.$_GET['option'].'&house&identify_id='.$items['id'].'&func=inv';				}				else				{					$ss = 'act.php?identify_id='.$items['id'].'&func=inv';				}				$Item->hint(0,1,'<a href="'.$ss.'" ');				echo 'Посмотреть</a>';				echo '</td></tr>';			}			echo '</table>';		}	}	elseif ($item==228) //клановые клейменные предметы	{		if (mysql_num_rows(myquery("SELECT clan_id FROM game_clans WHERE glava=$user_id AND raz=0"))>0)		{			$result_items = myquery("SELECT game_items.id FROM game_items WHERE game_items.kleymo=1 AND game_items.kleymo_id=".$char['clan_id']." AND (game_items.user_id<>".$char['user_id']." OR (game_items.user_id=".$char['user_id']." AND game_items.priznak NOT IN (0))) ORDER BY game_items.kleymo_nomer ASC");			if (mysql_num_rows($result_items) > 0)			{				echo '<table cellpadding="0" cellspacing="4" border="0">';				while ($items = mysql_fetch_array($result_items))				{					$str_info = '';					$Item = new Item($items['id']);					switch ($Item->getItem('priznak'))					{						case 0:						{							$user_name = get_user("name",$Item->getItem('user_id'));   							$str_info = 'Находится в инвентаре игрока '.$user_name;						}						break;						case 1:						{							$user_name = get_user("name",$Item->getItem('user_id'));							$str_info = 'Находится на рынке в городе '.mysqlresult(myquery("SELECT rustown FROM game_gorod WHERE town=".$Item->getItem('town').""),0,0).' (продавец '.$user_name.')';						}						break;						case 2:						{							$str_info = 'Находится на земле (Карта: '.mysqlresult(myquery("SELECT name FROM game_maps WHERE id=".$Item->getItem('map_name').""),0,0).',X='.$Item->getItem('map_xpos').',Y='.$Item->getItem('map_ypos').')';						}						break;						case 3:						{							$user_name = get_user("name",$Item->getItem('user_id'));							$str_info = 'Находится на почте в городе '.mysqlresult(myquery("SELECT rustown FROM game_gorod WHERE town=".$Item->getItem('town').""),0,0).' (отправитель '.$user_name.')';						}						break;						case 4:						{							$user_name = get_user("name",$Item->getItem('user_id'));							$str_info = 'Находится в хранилище игрока '.$user_name;						}						break;					}					echo '<tr><td>';					$Item->hint(0,1,'<span '); 					ImageItem($Item->fact['img'],0,$Item->item['kleymo']);					echo '</span>';					echo'</td>					<td>'.$Item->getItem('kleymo_nomer').'. '.$Item->getFact('name').'</td>					<td>'.$str_info.'</td>					<td><a href="http://'.domain_name.'/item.php?inv_option=kleymo_return&id='.$items['id'].'">Вернуть предмет</td>					</tr>';				}				echo '</table>';			}		}	}	elseif ($item==229) //личные клейменные предметы	{		$result_items = myquery("SELECT game_items.id FROM game_items WHERE game_items.kleymo=2 AND game_items.kleymo_id=".$char['user_id']." AND (game_items.user_id<>".$char['user_id']." OR (game_items.user_id=".$char['user_id']." AND game_items.priznak NOT IN (0))) ORDER BY game_items.kleymo_nomer ASC");		if (mysql_num_rows($result_items) > 0)		{			echo '<table cellpadding="0" cellspacing="4" border="0">';			while ($items = mysql_fetch_array($result_items))			{				$str_info = '';				$Item = new Item($items['id']);				switch ($Item->getItem('priznak'))				{					case 0:					{						$user_name = get_user("name",$Item->getItem('user_id'));						$str_info = 'Находится в инвентаре игрока '.$user_name;					}					break;					case 1:					{						$user_name = get_user("name",$Item->getItem('user_id'));						$str_info = 'Находится на рынке в городе '.mysqlresult(myquery("SELECT rustown FROM game_gorod WHERE town=".$Item->getItem('town').""),0,0).' (продавец '.$user_name.')';					}					break;					case 2:					{						$str_info = 'Находится на земле (Карта: '.mysqlresult(myquery("SELECT name FROM game_maps WHERE id=".$Item->getItem('map_name').""),0,0).',X='.$Item->getItem('map_xpos').',Y='.$Item->getItem('map_ypos').')';					}					break;					case 3:					{						$user_name = get_user("name",$Item->getItem('user_id'));						$str_info = 'Находится на почте в городе '.mysqlresult(myquery("SELECT rustown FROM game_gorod WHERE town=".$Item->getItem('town').""),0,0).' (отправитель '.$user_name.')';					}					break;					case 4:					{						$user_name = get_user("name",$Item->getItem('user_id'));						$str_info = 'Находится в хранилище игрока '.$user_name;					}					break;				}				echo '<tr><td>';					$Item->hint(0,1,'<span '); 					ImageItem($Item->fact['img'],0,$Item->item['kleymo']);					echo '</span>';				echo'</td>				<td>'.$Item->getItem('kleymo_nomer').'. '.$Item->getFact('name').'</td>				<td>'.$str_info.'</td>				<td><a href="http://'.domain_name.'/item.php?inv_option=kleymo_return&id='.$items['id'].'">Вернуть предмет</td>				</tr>';			}			echo '</table>';		}	}	elseif ($item==95) //ну и движково-квестовые	{		require_once("quest/quest_engine_types/inc/quest_define.inc.php");		$result_items = 		myquery("SELECT 		game_items_factsheet.name AS ident,		game_items_factsheet.id AS id_type,		game_items_factsheet.curse AS curse,		game_items_factsheet.img AS img, 		game_items.item_uselife AS weight,		game_items.item_cost AS item_cost,		game_items.id AS id,		game_items.kleymo AS kleymo,		game_items.item_for_quest AS item_for_quest		FROM game_items JOIN game_items_factsheet ON game_items.item_id=game_items_factsheet.id		 WHERE game_items.user_id='$user_id' AND game_items.used=0 AND game_items.priznak=0 AND game_items_factsheet.type=".qengine_item_type." ORDER BY game_items_factsheet.name");		if (mysql_num_rows($result_items) > 0)		{			$i=0;			while ($items = mysql_fetch_array($result_items))			{				echo '<table cellpadding="0" cellspacing="4" border="0">';				if($i!=0) {echo '<HR SIZE=1 WIDTH=60% ALIGN=center NOSHADE>'; }				if($i==0) $i=1;				if($items['id_type']==$id_item_part_monster OR $items['id_type']==$id_item_monstr_balden) 				{					$pre_mode='Бывший хозяин';					list($items['mode'])=mysql_fetch_array(myquery("SELECT opis FROM game_items_opis WHERE item_id=".$items['id'].""));				}				if($items['id_type']==$id_item_posylka) $pre_mode='Отправитель';				if($items['id_type']==$id_item_letter_complete) $pre_mode='Получатель';				if($items['id_type']==$id_item_posylka OR $items['id_type']==$id_item_letter_complete)				{					$items['mode'] = mysqlresult(myquery("SELECT name FROM quest_engine_owners WHERE id IN (SELECT item_for_quest FROM game_items WHERE id=".$items['id'].")"),0,0);				}				if($items['id_type']==$id_item_part_monster) 				{					list($part_name) = mysql_fetch_array(myquery("SELECT par1_name FROM quest_engine_users WHERE user_id='$user_id' AND quest_type=2 AND quest_owner_id=".$items['item_for_quest'].""));										$items['curse']=$part_name." монстра: <b>".(int)$items['item_cost']."</b> ".pluralForm($items['item_cost'],'штука','штуки','штук').".";				}				echo '<tr valign="middle"><td rowspan="4">';				ImageItem($items['img'],0,$items['kleymo']);				echo'</td>								<td><b><font color=#99ddff>Название: </font></b><font color=#99ffbb>'.$items['ident'].'</font></td></tr>				<tr><td><B><font color=#99ddff>Описание: </B></font><font color=yellow>'.$items['curse'].'</font></td></tr>				<tr><td><B><font color=#99ddff>'.$pre_mode.': </font><font color=#ffb8b8>'.$items['mode'].'</font></B></td></tr>				<tr><td><font color=#99ddff><B>Вес: </font><font color=red>'.$items['weight'].' кг.</font> </B></td></tr>';							}			echo '</table>';		}	}	else	{		$type = $item;		$result_items = myquery("SELECT game_items_factsheet.name,game_items.id,game_items.item_id,game_items_factsheet.type,game_items.item_uselife,game_items_factsheet.img,game_items.ref_id,game_items_factsheet.can_up,game_items.count_item, game_items_factsheet.can_use from game_items left join game_items_factsheet on game_items.item_id=game_items_factsheet.id WHERE game_items.user_id=$user_id AND game_items.used=0 AND game_items.priznak=0 and game_items_factsheet.type=$type ORDER BY ref_id, game_items_factsheet.name");		if ($result_items!=false AND mysql_num_rows($result_items)>0)		{			$nom=0;			$str_set='';			echo '<table cellpadding="0" cellspacing="4" border="0">';			while ($items = mysql_fetch_array($result_items))			{				if ($items['type']==22 and $items['ref_id']==0)				{					$col_14=$col_14+$items['count_item'];				}                if ($items['item_id']==item_id_part_svitok_hranitel)                {                    $col_part_svitok_hranitel=$col_part_svitok_hranitel+$items['count_item'];                }                if ($items['item_id']==item_id_part_svitok_ice_portal)                {                    $col_part_svitok_ice=$col_part_svitok_ice+$items['count_item'];                }								$link = $link1 = $link2 = '';				$ssylka='';				if ($items['can_up']==1)				{					if ($type==3)					{						if ($items["count_item"]<=0)							$ssylka='::DOT::Артефакт разряжен';						else						{							if ($items['ref_id']==1)							{								$ssylka='::DOT::Предмет неидентифицирован';							}							else							{								$ssylka='::DOT::<a href=::link::>Взять '.$items['name'].'</a>';								$link='"http://'.domain_name.'/item.php?inv_option=equip&id='.$items['id'].'"';							}						}					}					elseif ($type==2)					{						if ($items["item_uselife"]<=0)							$ssylka='::DOT::Кольцо сломано';						else						{							if ($items['ref_id']==1)							{								$ssylka='::DOT::Предмет неидентифицирован';							}							else							{								$ssylka='::DOT::<a href=::link::>Надеть '.$items['name'].' (в слот 1)</a>';								$link = '"http://'.domain_name.'/item.php?inv_option=equip&slot=1&id='.$items['id'].'"';								if($char['clevel']>=3)								{									$ssylka.='<BR>::DOT::<a href=::link1::>Надеть '.$items['name'].' (в слот 2)</a>';									$link1 = '"http://'.domain_name.'/item.php?inv_option=equip&slot=2&id='.$items['id'].'"';								}								if($char['clevel']>=7)								{									$ssylka.='<BR>::DOT::<a href=::link2::>Надеть '.$items['name'].' (в слот 3)</a>';									$link2 = '"http://'.domain_name.'/item.php?inv_option=equip&slot=3&id='.$items['id'].'"';								}							}						}					}					elseif ($type==4)					{						if ($items["item_uselife"]<=0)							$ssylka='::DOT::Щит сломан';						else						{							if ($items['ref_id']==1)							{								$ssylka='::DOT::Предмет неидентифицирован';							}							else							{								$ssylka='::DOT::<a href=::link::>Взять '.$items['name'].'</a>';								$link='"http://'.domain_name.'/item.php?inv_option=equip&id=' . $items['id'] . '"';							}						}					}					elseif ($type==6)					{						if ($items["item_uselife"]<=0)							$ssylka='::DOT::Шлем сломан';						else						{							if ($items['ref_id']==1)							{								$ssylka='::DOT::Предмет неидентифицирован';							}							else							{								$ssylka='::DOT::<a href=::link::>Надеть '.$items['name'].'</a>';								$link='"http://'.domain_name.'/item.php?inv_option=equip&id='.$items['id'].'"';							}						}					}					elseif ($type==5)					{						if ($items["item_uselife"]<=0)							$ssylka='::DOT::Доспех сломан';						else						{							if ($items['ref_id']==1)							{								$ssylka='::DOT::Предмет неидентифицирован';							}							else							{								$ssylka='::DOT::<a href=::link::>Надеть '.$items['name'].'</a>';								$link='"http://'.domain_name.'/item.php?inv_option=equip&id='.$items['id'].'"';							}						}					}					elseif ($type==1)					{						if ($items["item_uselife"]<=0)							$ssylka='::DOT::Оружие сломано';						else						{							if ($items['ref_id']==1)							{								$ssylka='::DOT::Предмет неидентифицирован';							}							else							{								$ssylka='::DOT::<a href=::link::>Взять '.$items['name'].'</a>';								$link='"http://'.domain_name.'/item.php?inv_option=equip&id='.$items['id'].'"';							}						}					}					elseif ($type==7)					{						if ($items["item_uselife"]<=0)							$ssylka='::DOT::Магия разряжена';						else						{							if ($items['ref_id']==1)							{								$ssylka='::DOT::Предмет неидентифицирован';							}							else							{								$ssylka='::DOT::<a href=::link::>Взять '.$items['name'].'</a>';								$link='"http://'.domain_name.'/item.php?inv_option=equip&id='.$items['id'].'"';							}						}					}					elseif ($type==8)					{						if ($items["item_uselife"]<=0)							$ssylka='::DOT::Пояс сломан';						else						{							if ($items['ref_id']==1)							{								$ssylka='::DOT::Предмет неидентифицирован';							}							else							{								$ssylka='::DOT::<a href=::link::>Надеть '.$items['name'].'</a>';								$link='"http://'.domain_name.'/item.php?inv_option=equip&id='.$items['id'].'"';							}						}					}					elseif ($type==9)					{						if ($items["item_uselife"]<=0)							$ssylka='::DOT::Ожерелье сломано';						else						{							if ($items['ref_id']==1)							{								$ssylka='::DOT::Предмет неидентифицирован';							}							else							{							$ssylka='::DOT::<a href=::link::>Надеть '.$items['name'].'</a>';							$link='"http://'.domain_name.'/item.php?inv_option=equip&id='.$items['id'].'"';						}					}					}					elseif ($type==10)					{						if ($items["item_uselife"]<=0)							$ssylka='::DOT::Перчатки изношены';						else						{							if ($items['ref_id']==1)							{								$ssylka='::DOT::Предмет неидентифицирован';							}							else							{							$ssylka='::DOT::<a href=::link::>Надеть '.$items['name'].'</a>';							$link='"http://'.domain_name.'/item.php?inv_option=equip&id='.$items['id'].'"';						}					}					}					elseif ($type==11)					{						if ($items["item_uselife"]<=0)							$ssylka='::DOT::Обувь изношена';						else						{							if ($items['ref_id']==1)							{								$ssylka='::DOT::Предмет неидентифицирован';							}							else							{							$ssylka='::DOT::<a href=::link::>Надеть '.$items['name'].'</a>';							$link='"http://'.domain_name.'/item.php?inv_option=equip&id='.$items['id'].'"';						}					}					}					elseif ($type==12)					{						if ($items["item_uselife"]<=0)							$ssylka='::DOT::Свитки закончились';						else						{							if ($items['ref_id']==1)							{								$ssylka='::DOT::Предмет неидентифицирован';							}							else							{							$ssylka='::DOT::<a href=::link::>Взять '.$items['name'].'</a>';							$link='"http://'.domain_name.'/item.php?inv_option=equip&id='.$items['id'].'"';						}					}					}					elseif ($type==13)					{						if ($items["item_uselife"]<=0)							$ssylka='::DOT::Эликсир закончился';						else						{							if ($items['ref_id']==1)							{								$ssylka='::DOT::Предмет неидентифицирован';							}							else							{								$ssylka='::DOT::<a href=::link::>Взять '.$items['name'].'</a>';								$link='"http://'.domain_name.'/item.php?inv_option=equip&id='.$items['id'].'"';							}						}					}					 elseif ($type==14)					{						if ($items["item_uselife"]<=0)							$ssylka='::DOT::Поножи изношены';						else						{							if ($items['ref_id']==1)							{								$ssylka='::DOT::Предмет неидентифицирован';							}							else							{							$ssylka='::DOT::<a href=::link::>Надеть '.$items['name'].'</a>';							$link='"http://'.domain_name.'/item.php?inv_option=equip&id='.$items['id'].'"';						}					}					}					elseif ($type==15)					{						if ($items["item_uselife"]<=0)							$ssylka='Наручи сломаны';						else						{							if ($items['ref_id']==1)							{								$ssylka='Предмет неидентифицирован';							}							else							{							$ssylka='::DOT::<a href=::link::>Надеть '.$items['name'].'</a>';							$link='"http://'.domain_name.'/item.php?inv_option=equip&id='.$items['id'].'"';						}					}					}					elseif ($type==16)					{						if ($items["item_uselife"]<=0)							$ssylka='::DOT::Украшение сломано';						else						{							if ($items['ref_id']==1)							{								$ssylka='::DOT::Предмет неидентифицирован';							}							else							{							    $ssylka='::DOT::<a href=::link::>Одеть украшения в слот 1</a>';							    $link='"../item.php?inv_option=equip&slot=1&id='.$items['id'].'"';							    $ssylka.='<br />::DOT::<a href=::link1::>Одеть украшения в слот 2</a>';							    $link1='"../item.php?inv_option=equip&slot=2&id='.$items['id'].'"';						    }					    }					}                    elseif ($type==18)                    {                        if ($items["item_uselife"]<=0)                            $ssylka='Оружие сломано';                        else                        {                            if ($items['ref_id']==1)                            {                                $ssylka='Предмет неидентифицирован';                            }                            else                            {                                $ssylka='::DOT::<a href=::link::>Взять '.$items['name'].'</a>';                                $link='"http://'.domain_name.'/item.php?inv_option=equip&id='.$items['id'].'"';                            }                        }                    }					elseif ($type==24)					{						if ($items["item_uselife"]<=0)							$ssylka='::DOT::Инструмент сломан';						else						{							if ($items['ref_id']==1)							{								$ssylka='::DOT::Предмет неидентифицирован';							}							else							{								$ssylka='::DOT::<a href=::link::>Взять '.$items['name'].'</a>';								$link='"http://'.domain_name.'/item.php?inv_option=equip&id=' . $items['id'] . '"';							}						}					}					//движок квестов					elseif ($type==95)					{						$ssylka='Невозможно одеть';					}				}				if ($type==97 or ($type==22 and $items['ref_id']==0)) 				{										$ssylka='<b>'.$items['name'].'</b></br><i>'.$items['count_item'].' '.pluralForm($items['count_item'],'предмет','предмета','предметов').'</i>';				}				elseif ($type==22 and $items['ref_id']==1)				{					$ssylka='Неидентифицировано';				}				elseif ($type==20)				{					$ssylka='<b>'.$items['name'].'</b>';				}				$Item = new Item($items['id']);				$check_up = $Item->check_up();				echo '<tr><td>';				if ($Item->item['ref_id']==1 AND (!$Item->counted_item() OR $Item->fact['type']==22) AND $Item->fact['type']!=20)				{					$Item->ImageUnidentItem();				}				else				{					$Item->hint(0,1,'<span '); 					ImageItem($Item->fact['img'],0,$Item->item['kleymo']);					echo '</span>';				}				if ($from_house AND $link!='')				{					$link='"'.str_replace('"','',$link).'&house&option='.$option.'"';    				}				if ($from_house AND $link1!='')				{					$link1='"'.str_replace('"','',$link1).'&house&option='.$option.'"';    				}				if ($from_house AND $link2!='')				{					$link2='"'.str_replace('"','',$link2).'&house&option='.$option.'"';    				}				if ($link!='')				{					$ssylka = str_replace('::link::',$link,$ssylka);				}				if ($link1!='')				{					$ssylka = str_replace('::link1::',$link1,$ssylka);				}				if ($link2!='')				{					$ssylka = str_replace('::link2::',$link2,$ssylka);				}				if ($check_up == 1) $dotsym = '<span style="color:chartreuse">&#149;</span> ';				else $dotsym = '<span style="color:red">&#149;</span> ';//				$dotsym = '<span style="color:gray">&#149;</span> ';				$ssylka = str_replace('::DOT::',$dotsym,$ssylka);				echo '</td><td>'.$ssylka.'</td><td>';								if ($items['can_use']==1)				{					echo ' <a href="../item.php?inv_option=use&id='.$items['id'].'">Использовать</a></td><td>';				}				                if ($Item->fact['id']==item_id_svitok_hranitel AND $char['map_name']==691)                {                    echo ' <a href="act.php?use_svitok_hranitel='.$items['id'].'&func=main">Использовать</a></td><td>';                }				if ($Item->item['personal']==0 AND !$from_house)				{      					if ($type==97 or $type==22)					{						echo "| <a href=\"?func=inv&dropitm=".$items['id']."\">Выкинуть</a></td>";					}					else					{						echo '| <a href="item.php?inv_option=drop&id='.$items['id'].'">Выкинуть</a></td>';					}				}				/*if ($from_house)				{					$ss = 'hero.php?option='.$_GET['option'].'&house&identify_id='.$items['id'].'&func=inv';				}				else				{					$ss = 'act.php?identify_id='.$items['id'].'&func=inv';				}				$Item->hint(0,1,'<a href="'.$ss.'" ');				echo 'Посмотреть</a>';*/                if ($Item->getFact('type')==3 and $items['ref_id']!=1 AND !$from_house)				{					$zar = $Item->getFact('item_uselife')-$Item->getItem('count_item');					if ($zar>0)					{						if ($char['STM_MAX']>$char['MP_MAX'])						{							$mp = 10;							$stm = 5;						}						else						{							$mp = 5;							$stm = 10;						}												$kol_mp = floor($char['MP']/$mp);						$kol_stm = floor($char['STM']/$stm);						$kol = min($kol_mp,$kol_stm);						$zar = min($zar,$kol);						if ($zar>0)						{							$sel_last_event = myquery("SELECT timestamp FROM game_users_event WHERE user_id=$user_id AND event=1");							if ($sel_last_event!=false AND mysql_num_rows($sel_last_event)>0)							{								list($last_event) = mysql_fetch_array($sel_last_event);							}							else							{								$last_event = 0;							}							if (($last_event+$Item->getFact('cooldown'))<time() AND !$from_house)							{								echo '</td><td>&nbsp;|&nbsp;<a href="?func=inv&option=charge&id='.$items['id'].'">Зарядить на '.$zar.' '.pluralForm($zar,'заряд','заряда','зарядов').'</a><td>';							}							else							{								$razn = ($last_event+$Item->getFact('cooldown'))-time();								$min = floor($razn/60);								$sec = $razn-$min*60;								echo '</td><td>&nbsp;&nbsp;&nbsp;&nbsp;Ты уже '.echo_sex('заряжал','заряжала').' артефакт '.date("d.m.Y H:i:s",$last_event).'. <br>&nbsp;&nbsp;|&nbsp;Тебе надо набраться сил.<br>&nbsp;&nbsp;&nbsp;&nbsp;Попробуй через '.$min.' мин. '.$sec.' сек.';							}						}                        					}			   }				$nom++;				echo'</td></tr>';			}			echo '</table>';		}	}		if (!$from_house and !$from_craft)	{		if ($col_14>=7)		{			QuoteTable('open','500px');			$link = "act.php?func=inv&make_amulet";					echo '<center>Ты '.echo_sex('собрал','собрала').' '.$col_14.' '.pluralForm($col_14,'Руну','Руны','Рун').' амулета. <br />Для сборки амулета достаточно иметь 7 Рун. Ты можешь <br /><br />			<a href='.$link.'>Создать Рунный Предмет.</a>			<br /><br />Характеристики нового предмета будут зависеть от того, из каких частей он собран!';			QuoteTable('close');		}		if ($col_part_svitok_hranitel>=5)		{			QuoteTable('open','500px');			echo '<center>Ты '.echo_sex('собрал','собрала').' '.$col_part_svitok_hranitel.' '.pluralForm($col_part_svitok_hranitel,'часть','части','частей').' Свитка Хранителя. <br />Для получения Свитка Хранителя достаточно иметь 5 частей. Ты можешь <br /><br /><a href="act.php?func=inv&make_svitok">Собрать Свиток Хранителя из частей</a>.';			QuoteTable('close');		}		if ($col_part_svitok_ice>=10)		{			QuoteTable('open','500px');			echo '<center>Ты '.echo_sex('собрал','собрала').' '.$col_part_svitok_ice.' '.pluralForm($col_part_svitok_ice,'часть','части','частей').' Свитка Снежного Портала. <br />Для получения Свитка Снежного Портала достаточно иметь 10 частей. <br />Ты можешь <br /><br /><a href="act.php?func=inv&make_svitok_ice">Собрать Свиток Снежного Портала из частей</a>.';			QuoteTable('close');		}	}	echo '</span>';}if (!isset($map)) {	if (isset($item))	{		$map=$item;	}	else	{		$map = 0;	}}?><script>function ge( a ){	if( document.all ) return document.all[a];	else return document.getElementById( a );}parent.ge( '<? echo'd'.$map.''; ?>' ).innerHTML=ge( 'qwe' ).innerHTML;</script>   <?if (function_exists("save_debug")) save_debug(); ?>